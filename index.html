<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة المخزون الذكي</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Tesseract.js -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container">
        <!-- Sidebar / Header -->
        <header class="header">
            <div class="logo">
                <i class="fa-solid fa-boxes-stacked"></i>
                <h1>المخزن الذكي</h1>
            </div>
            <nav>
                <button class="nav-btn active" id="btn-dashboard" onclick="switchTab('dashboard')"><i class="fa-solid fa-chart-line"></i> لوحة التحكم</button>
                <button class="nav-btn" id="btn-entry" onclick="switchTab('entry')"><i class="fa-solid fa-plus"></i> إضافة عملية</button>
                <button class="nav-btn" id="btn-reports" onclick="switchTab('reports')"><i class="fa-solid fa-file-pdf"></i> التقارير</button>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- Dashboard Section -->
            <section id="dashboard" class="tab-content active">
                <div class="cards-grid">
                    <div class="card summary-card" style="--accent: #4e73df;">
                        <div class="card-icon"><i class="fa-solid fa-box-open"></i></div>
                        <div class="card-info">
                            <h3>إجمالي الكميات</h3>
                            <p id="totalQuantity">0</p>
                        </div>
                    </div>
                    <div class="card summary-card" style="--accent: #1cc88a;">
                        <div class="card-icon"><i class="fa-solid fa-calendar-check"></i></div>
                        <div class="card-info">
                            <h3>عمليات اليوم</h3>
                            <p id="todayEntries">0</p>
                        </div>
                    </div>
                    <div class="card summary-card" style="--accent: #36b9cc;">
                        <div class="card-icon"><i class="fa-solid fa-chart-pie"></i></div>
                        <div class="card-info">
                            <h3>أعلى صنف</h3>
                            <p id="topItem">-</p>
                        </div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="card chart-card">
                        <h3><i class="fa-solid fa-chart-bar"></i> التحليل الشهري</h3>
                        <div class="chart-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>
                    <div class="card chart-card">
                        <h3><i class="fa-solid fa-chart-pie"></i> توزيع الأصناف</h3>
                        <div class="chart-container">
                            <canvas id="itemsChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card table-card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-list"></i> أحدث العمليات</h3>
                        <button onclick="refreshData()" class="action-btn sm"><i class="fa-solid fa-rotate"></i> تحديث</button>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>التاريخ</th>
                                    <th>الميناء (Port)</th>
                                    <th>الاسم (Name)</th>
                                    <th>الكمية (Qty)</th>
                                </tr>
                            </thead>
                            <tbody id="dataTableBody">
                                <tr><td colspan="4" class="loading-text">جاري تحميل البيانات...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Entry Form Section -->
            <section id="entry" class="tab-content">
                <div class="form-container card">
                    <h2><i class="fa-solid fa-pen-to-square"></i> تسجيل بيان جديد</h2>
                    
                    <!-- OCR Upload -->
                    <div class="ocr-section">
                        <div class="upload-area" id="dropZone">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            <p>اسحب صورة الفاتورة هنا أو اضغط للرفع (Tesseract OCR)</p>
                            <input type="file" id="ocrImageInput" accept="image/*" hidden>
                        </div>
                        <div id="ocrStatus" class="ocr-status hidden">
                            <div class="loader"></div>
                            <span>جاري قراءة البيانات...</span>
                        </div>
                        <div id="ocrPreview" class="ocr-preview hidden">
                            <img id="previewImg" src="" alt="Preview">
                        </div>
                    </div>

                    <form id="dataForm">
                        <div class="form-group">
                            <label>رقم الميناء (Port Number)</label>
                            <input type="text" id="portInput" name="port" required placeholder="مثال: A-101">
                        </div>
                        <div class="form-group">
                            <label>اسم الصنف (Name)</label>
                            <input type="text" id="nameInput" name="name" required placeholder="مثال: قطع غيار">
                        </div>
                        <div class="form-group">
                            <label>الكمية (Quantity)</label>
                            <input type="number" id="qtyInput" name="quantity" required placeholder="0">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="action-btn primary"><i class="fa-solid fa-floppy-disk"></i> حفظ البيانات</button>
                            <button type="button" onclick="clearForm()" class="action-btn secondary">مسح</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="tab-content">
                <div class="reports-container card">
                    <h2><i class="fa-solid fa-print"></i> إصدار التقارير</h2>
                    <p>قم بتوليد تقرير PDF يحتوي على ملخص العمليات والرسوم البيانية.</p>
                    
                    <div class="report-options">
                        <button onclick="requestPDF()" class="pdf-btn" id="generatePdfBtn">
                            <i class="fa-solid fa-file-pdf"></i>
                            <span>توليد التقرير الشامل (PDF)</span>
                        </button>
                    </div>
                    
                    <div id="pdfLoading" class="hidden">
                        <div class="loader"></div>
                        <p>جاري إنشاء التقرير، يرجى الانتظار...</p>
                    </div>

                    <div id="pdfResult" class="pdf-result hidden">
                        <div class="success-icon"><i class="fa-solid fa-check-circle"></i></div>
                        <p>تم إنشاء التقرير بنجاح!</p>
                        <a href="#" id="pdfDownloadLink" target="_blank" class="download-link">
                            <i class="fa-solid fa-download"></i> تحميل الملف
                        </a>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Scripts -->
    <script src="script.js"></script>
</body>
</html>
